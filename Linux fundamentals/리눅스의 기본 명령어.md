# Section 1. 사용자 생성 및 계정 관리

## [명령어와 도움말의 사용법]

### 1) 리눅스 명령어 개요

<명령어 which>

- 명령어의 경로 확인 명령어
- 명령어의 위치를 찾아주며 alias가 설정되어 있으면 함께 보여준다.
- 현재 PATH 환경변수에 설정된 경로에서 해당 명령어를 찾는다. → bash 내장 명령어는 못 찾을 수 있음

```jsx
which 명령어
```

<명령어 alias와 unalias>

- alias : 자주 사용하는 명령어를 특정 문자로 입력해두고 명령어 대신 해당 문자를 사용할 수 있게 하는 명령어
- unalias: alias기능을 해제한다.

```bash
alias 이제부터부를별명='원래명령어'

unalias 옵션 단축명령어 
# -a 옵션을 붙이면 설정된 모든 alias를 해제할 수 있다. 

```

<환경변수 PATH>

- 실행파일들의 디렉토리 위치를 저장해 놓은 환경변수
- 명령어 입력자의 현재 작업 디렉토리와 상관없이 특정 명령어를 입력하면 PATH 변수에 저장되어 있는 경로에서 해당 명령어를 찾아 실행
- 명령어 ‘echo $PATH’는 지정된 PATH 을 확인할 수 있다.
- **기존의 PATH에 새로운 경로를 추가하는 방법**
    - 명령어 PATH나 홈 디렉터리의 .bash_profile에 PATH를 추가한다.
    - 기존 경로와 새 경로는 콜론으로 구분한다.
```bash
export 변수명=$변수명:변수값
```

### 2) 리눅스 도움말

<명령어 man>

- 리눅스에서 사용하는 명령어들의 메뉴얼을 제공한다.

```bash
# []는 생략가능한 부분임. 
man [섹션] [옵션] 명령어

#예시 - 명령여 uname의 사용법을 호가인한다. 
man -a uname

```

| **옵션** | **설명** |
| --- | --- |
| -a | 찾고자 하는 명령어와 관련된 **모든 검색된 man 페이지 출력** |
| -h | **사용법(Help)** 출력 |
| -f | whatis 명령과 동일, **키워드와 정확히 일치하는 man 페이지 출력** |
| -k | apropos 명령과 동일, **키워드가 포함된 man 페이지 출력** |
| -w | 찾고자 하는 **man 페이지 파일의 위치 출력** |

| **섹션** | **의미** |
| --- | --- |
| 1 | 사용자 명령어 |
| 2 | 시스템 호출 (syscall) |
| 3 | 라이브러리 함수 |
| 4 | 장치 파일 |
| 5 | 설정 파일 형식 |
| 6 | 게임 |
| 7 | 개요/규칙 |
| 8 | 시스템 관리 명령 |


<명령어 info>

- 리눅스 명령어의 사용 방법, 옵션 등을 나타낸다.
- 명령어 man에 비해 제공되는 명령어가 한정적이다.
    - 빠른 확인 → man
    - 개념 학습 → info

<명령어 whatis>

- 명령어에 대한 기능을 간략하게 나타낸다.
- 자세한 사용법과 설명은 man이나 info로 확인해야한다.
- 키워드가 완전히 일치해야만 해당 명령어의 기능을 확인할 수 있다.
- whatis 데이터베이스에서 문자열만 검색한다.

```bash
whatis 명령어
```

![image.png](attachment:da4418ce-0c7e-40a0-bcff-319bb16bc74e:image.png)

<man, ls, whatis 비교>

| **구분** | whatis | man | info |
| --- | --- | --- | --- |
| 목적 | **한 줄 요약 확인** | **명령어 레퍼런스** | **개념·설명 중심 매뉴얼** |
| 출력 내용 | 명령어 기능 **요약 1줄** | 옵션, 문법, 설명 | 구조적·계층적 설명 |
| 설명 깊이 | 매우 얕음 | 중간 | 깊음 |
| 사용 상황 | “이게 뭐였지?” | “옵션 뭐지?” | “어떻게/왜 동작하지?” |
| 키워드 일치 | **완전 일치만 가능** | 부분적으로 가능 | 메뉴 탐색 |
| 데이터 출처 | whatis DB | man page | GNU info 문서 |
| 시험/실무 활용도 | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ |


<명령어 whereis>

- 찾고자 하는 명령어의 실행 파일의 절대 경로와 소스코드, 설정 파일 및 매뉴얼 페이지를 찾아 출력하는 명령어다.

```bash
whereis 명령어

# 예시 - 명령어 shutdown 의 소스파일 위치나 매뉴월 페이지의 위치 정보를 출력한다. 
whreis shutdown 
```

| **옵션** | **설명** |
| --- | --- |
| -b | 바이너리 파일만 찾음 |
| -m | 지정된 매뉴얼 섹션에서만 찾음 |
| -M | 매뉴얼 페이지의 위치를 제한 |
| -u | 특정 파일을 제외 |

<명령어 apropos>

- man페이지 설명에서 지정한 키워드를 포함하고 있는 명령어
- whatis 데이터베이스에서 문자열을 포함한 것을 검색한다.
- whatis 데이터베이스가 만들어져 있어야 이 명령어를 쓸 수 있다.

```bash
apropos 문자열

# 예시 - 명령어 매뉴얼에서 system이 포함된 명령어 목록을 출력한다. 
apropos system
```


## [사용자 계정의 생성과 관리]

### 1) 사용자 생성 명령어

<명령어 useradd>

- 계정을 생성하는 명령어
- 명령어 adduser와 동일한 기능을 갖는다.
- 계정자의 홈 디렉토리는 /home/계정명 이다.
- 생성된 계정 정보는 /etc/passwd, /etc/group에 저장된다.

```bash
useradd [옵션] 계정명
```

| **옵션** | **설명** |
| --- | --- |
| -s | 사용자의 로그인 기본 셸을 지정 |
| -d | 계정의 홈 디렉터리를 지정 |
| -f | 패스워드가 만기된 후 계정이 영구히 말소될 때까지의 기간 지정 |
| -e | 사용자 계정의 유효기간 설정일정 기간 동안 사용 가능한 임시 계정을 만들 때 사용 |
| -c | 파일 /etc/passwd에 새로운 사용자 설명을 추가 |
| -G | 기본 그룹 외에 추가로 소속될 그룹 지정 |

<명령어 passwd>

- 생성된 계정자의 패스워드를 입력 및 변경하는 명령어이다.
- 생성된 계정자의 패스워드는 /etc/shadow파일 안에 기록된다.

| **옵션** | **설명** |
| --- | --- |
| -S | 계정 상태 표시(Status)PS: 정상NP: 패스워드 없음LK: Lock 상태(또는 NP 상태) |
| -d | 계정 패스워드 삭제(delete) |
| -l | 계정을 lock 상태로 변경(lock) |
| -u | 계정의 lock 상태 해제(unlock) |

```bash
passwd [옵션] 계정명
```

<명령어 su>

- 명령어 su는 switch user의 줄임말이다.
- 현재의 사용자 게정에서 로그아웃하지 않고 다른 사용자 게정으로 로그인하여 해당 사용자의 권한을 획득하는 명령어

| **옵션** | **설명** |
| --- | --- |
| - , -l , --login | 지정한 사용자의 환경변수를 적용하여 로그인 |
| -s | 지정된 셸로 로그인 |
| -c | 셸을 실행하지 않고 주어진 명령어 수행 |

![image.png](attachment:8fb4d2ad-e9b8-440d-9ab3-dd76ea6480ae:image.png)

<su - 와 su 차이>

| **분** | su | su - |
| --- | --- | --- |
| 사용자 전환 | O | O |
| 환경변수 | **현재 사용자 환경 유지** | **대상 사용자 환경 적용** |
| HOME | 기존 사용자 HOME | 대상 사용자 HOME |
| PATH | 기존 PATH | 대상 사용자 PATH |
| 로그인 셸 | ❌ | ✅ (로그인 셸) |
| 사용 목적 | 권한만 잠깐 필요 | **완전한 사용자 전환** |

→ 

- **환경 그대로 두고 권한만 필요** → su
- **root로 완전히 로그인한 것처럼 작업** → su -

## 2) 사용자 관련 파일

<파일 /etc/default/useradd>

- 명령어 useradd로 사용자 계정을 추가할 때 사용되는 정보를 읽어오는 파일이다.

| **옵션** | **설명** |
| --- | --- |
| -g | 기본 그룹(GID) 변경 |
| -b | 기본 홈 디렉터리 변경 |
| -i | INACTIVE 값 변경 |
| -e | 계정 종료일(EXPIRE) 변경 |
| -s | 기본 셸 변경 |

→ **/etc/default/useradd를 수정하면 그 이후에 생성되는 사용자부터는 옵션을 따로 주지 않아도 그 값이 기본값으로 적용된다.**

<파일 /etc/passwd>

- 계정자의 정보를 가지고 있는 파일로 리눅스에 로그인할 때 사용된다.
- 파일 내용은 여러 개의 필드로 구성되어 있으며 콜론(:)으로 각각의 필드를 구분한다.

username:password:uid:gid:comment:homedirectory:shell

| **순서** | **필드명** | **설명** |
| --- | --- | --- |
| ① | username | 사용자 이름 |
| ② | password | 암호화된 비밀번호 저장 위치 표시• pwconv 활성화 시: x 로 표시 → 실제 비밀번호는 /etc/shadow에 저장• pwunconv 상태: 이 필드에 암호화 비밀번호가 직접 저장 |
| ③ | uid | 사용자 UID (시스템이 사용자를 관리하기 위해 부여한 번호) |
| ④ | gid | 사용자 GID (기본 그룹 ID, 사용자가 속한 main 그룹 번호) |
| ⑤ | comment | 사용자 설명 필드 (보안상 요즘은 거의 사용하지 않음) |
| ⑥ | homedirectory | 사용자 홈 디렉터리 경로 (일반적으로 /home/계정명) |
| ⑦ | shell | 로그인 시 실행되는 프로그램 (일반적으로 로그인 셸) |
|  |  |  |
- 커널은 사용자를 식별하기 위해 이름이 아니라 UID, GID라는 고유 번호를 사용함
- 사용자번호, 그룹번호이다. setuid, setgid랑은 다른개념임.

<파일 /etc/shadow>

- 계정자의 패스워드 정보가 암호화되어 있는 파일로 암호화 패스워드 및 계정의 유효 기간 등을 기록하고 있는 파일이다.
- username:password:lastchange:mindays:maxdays:warndays:inactive:expire:flag

| **순서** | **필드명** | **설명** |
| --- | --- | --- |
| ① | username | 사용자 계정명 |
| ② | password | 암호화된 비밀번호 |
| ③ | lastchange | 최근 비밀번호 변경일(1970-01-01 기준으로 계산된 일 수) |
| ④ | mindays | 암호 변경 후 **최소 사용 기간**예: 10 → 최소 10일은 같은 암호 사용 |
| ⑤ | maxdays | 암호를 사용할 수 있는 **최대 기간**예: 90 → 최대 90일 사용 가능 |
| ⑥ | warndays | 암호 만료 전 **경고 시작 일수**예: 5 → 만료 5일 전부터 경고 표시 |
| ⑦ | inactive | 암호 만료 후에도 로그인 가능한 기간예: 7 → 만료 후 7일까지 로그인 가능이후 계정 잠김 |
| ⑧ | expire | 사용자 계정 **만료일**이 날짜가 지나면 로그인 불가(1970-01-01 기준 일 수) |
| ⑨ | flag | 예약 필드 (현재 사용하지 않음, 보통 0) |

<파일 /etc/login.defs>

- 사용자 계정 설정과 관련된 기본값을 정의한 파일
- 새로운 계정을 생성할 때 반드시 참조하는 파일이다.

</etc/default/useradd 와 /etc/login.defs의 차이>

> **/etc/login.defs는 사용자 계정 및 로그인에 대한 시스템 전역 정책 파일이며,**
> 

> **/etc/default/useradd는 useradd 명령의 기본 옵션을 정의하는 파일이다.**
> 

> **계정 생성 시 두 파일 모두 참조되나 역할은 다르다.**
> 

| **구분** | /etc/login.defs | /etc/default/useradd |
| --- | --- | --- |
| 성격 | **전역 정책** | **명령어 기본 옵션** |
| 적용 대상 | login, passwd, useradd 등 | useradd 전용 |
| 관리 범위 | 보안/정책 | 생성 옵션 |
| UID/GID 범위 | ⭕ | ❌ |
| 패스워드 정책 | ⭕ | ❌ |
| 기본 셸 | ❌ | ⭕ |
| 홈 디렉터리 경로 | ❌ | ⭕ |


### 3) 사용자 계정 관리

<명령어 usermod>

- 디렉토리 /home에 위치한 사용자들의 정보를 변경하는 명령어이다.
- 사용자의 홈 디렉토리, 그룹, 유효기간 등을 변경한다.

```bash
usermod [옵션] 계정명
```

| **옵션** | **설명** |
| --- | --- |
| -u uid | 새로운 UID 지정※ -o 옵션과 함께 사용하면 기존 UID와 중복되더라도 강제 설정 가능 |
| -g | 새로운 GID 지정사용자의 **기본 그룹** 지정 또는 변경 |
| -G | 새로운 **보조 그룹** 지정기존 그룹에 포함된 상태에서 새로운 그룹에 추가 |
| -d 홈디렉터리 | 새로운 홈 디렉터리 지정 |
| -m | -d 옵션과 함께 사용 시 **홈 디렉터리를 새 위치로 이동/생성** |
| -s 셸 | 새로운 로그인 셸 지정 |
| -c 주석 | 새로운 주석(설명) 지정 |
| -l ID | 로그인 ID 변경(새 계정명으로 변경) |

<명령어 userdel>

- 기존 계정 정보를 삭제하는 명령어이다.
- 옵션 없이 userdel을 사용하면 디렉토리 /etc/passwd, /etc/shadow, /etc/group에서 해당 계정의 정보가 삭제된다.

```bash
userdel [옵션] 계정명
```

<명령어 chage> → chage age

- 패스워드의 만료 정보를 변경하는 리눅스 명령어

```bash
chage [옵션] [계정명]
```

### 3) 그룹 관리

그룹은 여러 사용자의 접근 권한을 효율적으로, 안전하게, 팀 단위로 관리하기 위해 필요하다.

<파일 /etc/group>

- 사용자 그룹에 대해 정의되어 있는 파일이다.
- 모든 계정은 한 개 이상의 그룹에 포함되어 있다.
- 파일 /etc/group을 이용하여 게정의 그룹에 대한 변경을 직접 파일을 수정하거나 명령어를 이용하여 변경할 수 있다.
- groupname : password : gid : members

| **번호** | **항목** | **설명** |
| --- | --- | --- |
| ① | groupname | 그룹명 |
| ② | password | 그룹 비밀번호 (보통 x로 표시, 실제 암호는 /etc/gshadow에 저장) |
| ③ | gid | 그룹 번호 (GID, 기본 그룹 식별 번호) |
| ④ | members | 그룹 멤버 리스트 (여러 명일 경우 ,로 구분) |

<파일 /etc/gshadow>

- 그룹의 암호를 MD5로 하여 저장하며 그룹의 소유주, 구성원 설정이 가능하다.

```bash
groupname : password : administrators : members
```

| **구분** | **항목** | **설명** |
| --- | --- | --- |
| ① | groupname | 그룹명 |
| ② | password | 그룹 비밀번호 (없으면 ! 또는 *로 표시) |
| ③ | administrators | 그룹 관리자 (복수 가능, 쉼표로 구분) |
| ④ | members | 그룹 구성원 (복수 가능, 쉼표로 구분) |

<명령어 groupadd>

- 새로운 그룹을 생성하는 명령어이다.

```bash
groupadd [옵션] 그룹명
```

| 옵션 | 설명 |
| --- | --- |
| -g 그룹 아이디 | 그룹에 gid를 지정 |
| -r |   • 시스템 그룹 생성 시 사용
  • 500번 이하 값 지정( 남아 있는 가장 높은 범위로 할당) |

<명령어 groupdel>

- 기존의 그룹을 삭제하는 명령어
- 그룹 안에 소속되어 있는 계정명이 있을 경우 해당 그룹은 삭제되지 않는다.
    - 보조 그룹은 상관없이 삭제가 가능하다.
    - 기본 그룹에 해당하는 계정이 하나라도 있으면 삭제가 안된다.
    - /etc/passwd에 계정구조가 깨지기 때문이다.
    - 그룹을 삭제하려면 해당되는 계정의 기본그룹을 다른 그룹으로 변환한뒤 해당 그룹을 삭제해야한다.

```bash
groupdel 그룹명
```

<명령어 groupmod>

- 그룹의 설정을 변경하는 명령어이다.

```bash
groupmod [옵션] 그룹명
```

| 옵션 | 설명 |  |
| --- | --- | --- |
| -g 그룹아이디 |   • gid를 변경
  • 옵션 -o와 함께 사용해서 중복 설정을 해줌 |  |
| -n 그룹명 |   • 새로운 그룹명을 변경할 때 사용 |  |

